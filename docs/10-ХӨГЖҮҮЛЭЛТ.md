# СДЗН Платформ - Хөгжүүлэлтийн гарын авлага

## Орчин бэлтгэх

### Шаардлагатай програмууд

| Програм | Хувилбар | Татах |
|---------|----------|-------|
| Go | 1.22+ | https://go.dev/dl/ |
| Node.js | 20 LTS | https://nodejs.org/ |
| Docker | 24+ | https://docker.com/ |
| Git | 2.40+ | https://git-scm.com/ |
| VS Code | Latest | https://code.visualstudio.com/ |

### VS Code Extensions

```json
{
  "recommendations": [
    "golang.go",
    "ms-azuretools.vscode-docker",
    "dbaeumer.vscode-eslint",
    "esbenp.prettier-vscode",
    "bradlc.vscode-tailwindcss",
    "prisma.prisma"
  ]
}
```

---

## Төсөл clone хийх

```bash
# Repository clone
git clone https://github.com/your-org/sdyn-platform.git
cd sdyn-platform

# Environment file хуулах
cp .env.example .env
# .env файлыг засах
```

---

## Backend хөгжүүлэлт (Go)

### Local дээр ажиллуулах

```bash
cd backend

# Dependencies татах
go mod download

# Database migration
go run cmd/migrate/main.go up

# Server эхлүүлэх
go run cmd/server/main.go
```

### Hot reload (Air)

```bash
# Air суулгах
go install github.com/air-verse/air@latest

# Ажиллуулах
cd backend
air
```

### Air config (`.air.toml`)

```toml
root = "."
tmp_dir = "tmp"

[build]
cmd = "go build -o ./tmp/main ./cmd/server"
bin = "./tmp/main"
include_ext = ["go", "tpl", "tmpl", "html"]
exclude_dir = ["tmp", "vendor"]
delay = 1000

[log]
time = false

[color]
main = "magenta"
watcher = "cyan"
build = "yellow"
runner = "green"
```

### Test ажиллуулах

```bash
# Бүх test
go test ./...

# Coverage
go test -coverprofile=coverage.out ./...
go tool cover -html=coverage.out

# Тодорхой package
go test ./internal/handlers/...
```

### Lint

```bash
# golangci-lint суулгах
go install github.com/golangci/golangci-lint/cmd/golangci-lint@latest

# Ажиллуулах
golangci-lint run
```

### API Documentation (Swagger)

```bash
# swag суулгах
go install github.com/swaggo/swag/cmd/swag@latest

# Docs үүсгэх
cd backend
swag init -g cmd/server/main.go -o docs

# Swagger UI: http://localhost:8080/swagger/
```

---

## Frontend хөгжүүлэлт (Next.js)

### Local дээр ажиллуулах

```bash
cd frontend

# Dependencies суулгах
npm install

# Development server
npm run dev
```

### Build

```bash
# Production build
npm run build

# Build шалгах
npm run start
```

### Lint & Format

```bash
# ESLint
npm run lint

# Prettier
npm run format
```

### Test

```bash
# Jest tests
npm test

# Watch mode
npm test -- --watch

# Coverage
npm test -- --coverage
```

### Storybook (Component library)

```bash
# Storybook суулгах
npx storybook@latest init

# Ажиллуулах
npm run storybook
```

---

## Admin Portal хөгжүүлэлт

### Local дээр ажиллуулах

```bash
cd admin

# Dependencies
npm install

# Development
npm run dev
```

### Environment variables

```env
NEXT_PUBLIC_API_URL=http://localhost:8080
NEXT_PUBLIC_KEYCLOAK_URL=http://localhost:8081
NEXT_PUBLIC_KEYCLOAK_REALM=sdyn
NEXT_PUBLIC_KEYCLOAK_CLIENT_ID=sdyn-admin
```

---

## Database хөгжүүлэлт

### Local PostgreSQL (Docker)

```bash
# PostgreSQL container эхлүүлэх
docker run -d \
  --name sdyn-postgres-dev \
  -e POSTGRES_USER=sdyn_user \
  -e POSTGRES_PASSWORD=dev_password \
  -e POSTGRES_DB=sdyn_db \
  -p 5432:5432 \
  postgres:16-alpine
```

### Migration үүсгэх

```bash
cd backend

# Шинэ migration
migrate create -ext sql -dir migrations -seq add_new_table

# Migration ажиллуулах
go run cmd/migrate/main.go up

# Rollback
go run cmd/migrate/main.go down 1
```

### Migration жишээ

```sql
-- migrations/000002_add_events.up.sql
CREATE TABLE events (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    title VARCHAR(255) NOT NULL,
    description TEXT,
    event_type VARCHAR(50),
    start_date TIMESTAMPTZ NOT NULL,
    end_date TIMESTAMPTZ NOT NULL,
    location VARCHAR(255),
    max_participants INTEGER,
    organization_id UUID REFERENCES organizations(id),
    created_at TIMESTAMPTZ DEFAULT NOW(),
    updated_at TIMESTAMPTZ DEFAULT NOW()
);

CREATE INDEX idx_events_organization ON events(organization_id);
CREATE INDEX idx_events_dates ON events(start_date, end_date);

-- migrations/000002_add_events.down.sql
DROP TABLE IF EXISTS events;
```

### Database seed

```bash
# Seed data оруулах
go run cmd/seed/main.go
```

---

## Docker хөгжүүлэлт

### Development compose

```bash
# Бүх сервис эхлүүлэх
docker compose -f docker-compose.dev.yml up -d

# Зөвхөн infrastructure
docker compose -f docker-compose.dev.yml up -d postgres redis keycloak minio
```

### docker-compose.dev.yml

```yaml
version: '3.8'

services:
  postgres:
    image: postgres:16-alpine
    environment:
      POSTGRES_USER: sdyn_user
      POSTGRES_PASSWORD: dev_password
      POSTGRES_DB: sdyn_db
    ports:
      - "5432:5432"
    volumes:
      - postgres_data:/var/lib/postgresql/data

  redis:
    image: redis:7-alpine
    command: redis-server --requirepass dev_password
    ports:
      - "6379:6379"

  keycloak:
    image: quay.io/keycloak/keycloak:24.0
    environment:
      KEYCLOAK_ADMIN: admin
      KEYCLOAK_ADMIN_PASSWORD: admin
      KC_DB: postgres
      KC_DB_URL: jdbc:postgresql://postgres:5432/keycloak
      KC_DB_USERNAME: sdyn_user
      KC_DB_PASSWORD: dev_password
    command: start-dev
    ports:
      - "8081:8080"
    depends_on:
      - postgres

  minio:
    image: minio/minio:latest
    environment:
      MINIO_ROOT_USER: minioadmin
      MINIO_ROOT_PASSWORD: minioadmin
    command: server /data --console-address ":9001"
    ports:
      - "9000:9000"
      - "9001:9001"

volumes:
  postgres_data:
```

---

## Git Workflow

### Branch naming

```
feature/SDYN-123-add-member-search
bugfix/SDYN-456-fix-login-error
hotfix/SDYN-789-security-patch
release/v1.2.0
```

### Commit message format

```
type(scope): short description

[optional body]

[optional footer]
```

Types:
- `feat`: Шинэ feature
- `fix`: Bug засвар
- `docs`: Documentation
- `style`: Formatting
- `refactor`: Code refactoring
- `test`: Test нэмэх
- `chore`: Maintenance

### Pull Request template

```markdown
## Тодорхойлолт
<!-- Юу хийсэн бэ? -->

## Өөрчлөлтийн төрөл
- [ ] Bug fix
- [ ] New feature
- [ ] Breaking change
- [ ] Documentation

## Шалгалт
- [ ] Local дээр test хийсэн
- [ ] Unit test нэмсэн
- [ ] Documentation шинэчилсэн

## Screenshots
<!-- Хэрэв UI өөрчлөлт байвал -->
```

---

## API хөгжүүлэлт

### Шинэ endpoint нэмэх

1. **Model үүсгэх** (`internal/models/`)
```go
type Event struct {
    ID          uuid.UUID `json:"id" gorm:"type:uuid;default:gen_random_uuid()"`
    Title       string    `json:"title" validate:"required"`
    Description string    `json:"description"`
    // ...
}
```

2. **Repository үүсгэх** (`internal/repository/`)
```go
type EventRepository interface {
    Create(event *models.Event) error
    FindByID(id uuid.UUID) (*models.Event, error)
    FindAll(params QueryParams) ([]models.Event, int64, error)
    // ...
}
```

3. **Service үүсгэх** (`internal/services/`)
```go
type EventService struct {
    repo repository.EventRepository
}

func (s *EventService) CreateEvent(input CreateEventInput) (*models.Event, error) {
    // Business logic
}
```

4. **Handler үүсгэх** (`internal/handlers/`)
```go
// CreateEvent godoc
// @Summary Create a new event
// @Tags events
// @Accept json
// @Produce json
// @Param event body CreateEventInput true "Event data"
// @Success 201 {object} models.Event
// @Router /api/v1/events [post]
func (h *EventHandler) CreateEvent(c *fiber.Ctx) error {
    // Handler logic
}
```

5. **Route нэмэх** (`cmd/server/main.go`)
```go
api.Post("/events", eventHandler.CreateEvent)
api.Get("/events", eventHandler.GetEvents)
api.Get("/events/:id", eventHandler.GetEvent)
```

---

## Testing

### Unit test жишээ

```go
func TestMemberService_Create(t *testing.T) {
    // Arrange
    mockRepo := new(MockMemberRepository)
    service := NewMemberService(mockRepo)

    input := CreateMemberInput{
        FirstName: "Test",
        LastName:  "User",
        Email:     "test@example.com",
    }

    mockRepo.On("Create", mock.Anything).Return(nil)

    // Act
    member, err := service.Create(input)

    // Assert
    assert.NoError(t, err)
    assert.Equal(t, "Test", member.FirstName)
    mockRepo.AssertExpectations(t)
}
```

### Integration test

```go
func TestAPI_CreateMember(t *testing.T) {
    // Setup
    app := setupTestApp()

    // Test
    req := httptest.NewRequest("POST", "/api/v1/members", strings.NewReader(`{
        "first_name": "Test",
        "last_name": "User",
        "email": "test@example.com"
    }`))
    req.Header.Set("Content-Type", "application/json")

    resp, _ := app.Test(req)

    // Assert
    assert.Equal(t, 201, resp.StatusCode)
}
```

---

## Debugging

### VS Code launch.json

```json
{
  "version": "0.2.0",
  "configurations": [
    {
      "name": "Launch Backend",
      "type": "go",
      "request": "launch",
      "mode": "auto",
      "program": "${workspaceFolder}/backend/cmd/server",
      "env": {
        "DATABASE_URL": "postgres://sdyn_user:dev_password@localhost:5432/sdyn_db"
      }
    },
    {
      "name": "Launch Frontend",
      "type": "node",
      "request": "launch",
      "runtimeExecutable": "npm",
      "runtimeArgs": ["run", "dev"],
      "cwd": "${workspaceFolder}/frontend"
    }
  ]
}
```

### Go Delve debugger

```bash
# Delve суулгах
go install github.com/go-delve/delve/cmd/dlv@latest

# Debug mode
dlv debug ./cmd/server/main.go
```

---

## Performance Profiling

### Go pprof

```go
import _ "net/http/pprof"

// main.go дээр нэмэх
go func() {
    log.Println(http.ListenAndServe("localhost:6060", nil))
}()
```

```bash
# CPU profile
go tool pprof http://localhost:6060/debug/pprof/profile?seconds=30

# Memory profile
go tool pprof http://localhost:6060/debug/pprof/heap
```

---

## Useful Commands

```bash
# Go
go mod tidy                    # Dependencies цэвэрлэх
go generate ./...              # Code generation
go build -ldflags="-s -w"      # Optimized build

# Node.js
npm outdated                   # Хуучирсан packages
npm audit                      # Security audit
npm run analyze                # Bundle analyze

# Docker
docker system prune -a         # Cleanup
docker compose logs -f         # Live logs
docker compose exec backend sh # Container руу орох

# Database
psql -h localhost -U sdyn_user -d sdyn_db
```

---
*Баримт бичгийн хувилбар: 1.0*
*Сүүлд шинэчилсэн: 2026-01-26*
